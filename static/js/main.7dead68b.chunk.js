(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(e,t,n){},57:function(e,t,n){e.exports=n(94)},62:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(47),o=n.n(r),c=n(5),l=n.n(c),s=n(18),u=n(22),d=n(13),m=n(26),p=n(55),g=n(48),h=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function f(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}n(62);var b=n(19),v=n(8),k=n(9),E=n(11),w=n(10),y=n(12),O=(n(24),n(28)),j=n(20),C=n(21),I=n.n(C);function N(){var e=Object(j.a)(["\n\tmutation addIngredient($name: String!) {\n\t\taddIngredient(name: $name) @client\n\t}\n"]);return N=function(){return e},e}function x(){var e=Object(j.a)(["\n\tquery {\n\t\tingredients @client {\n\t\t\tid,\n\t\t\tname\n\t\t}\n\t}\n"]);return x=function(){return e},e}var F=I()(x()),S=I()(N()),$={Mutation:{addIngredient:function(e,t,n){var a=t.name,i=n.cache,r=i.readQuery({query:F}),o={__typename:"Ingredient",id:r.ingredients.length?l.a.maxBy(r.ingredients,"id").id+1:1,name:a},c={ingredients:[].concat(Object(b.a)(r.ingredients),[o])};return i.writeData({data:c}),o}}},R=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(E.a)(this,Object(w.a)(t).call(this,e))).handleValidate=function(e){if("Enter"==e.key){var t=l.a.head(n.state.suggests);t&&!t.isNew&&n.addToFilter(l.a.head(n.state.suggests))}},n.handleChange=function(e){var t=!1,a=e.target.value,i=l.a.slice(l.a.filter(n.props.ingredients,function(e){return e.name==a&&(t=!0),l.a.startsWith(e.name,l.a.toLower(a))}),0,5);n.state.allowNew&&!t&&""!=a&&i.unshift({id:0,name:l.a.toLower(a),isNew:!0}),""==a?n.clear():n.setState({value:a,suggests:i})},n.clear=function(){n.setState({value:"",suggests:[]})},n.addToFilter=function(e){n.props.filterByIngredient(e),n.clear(),n._input.focus()},n.state={allowNew:!!n.props.allowNew,autoFocus:!!n.props.autoFocus,value:"",suggests:[]},n.handleChange=n.handleChange.bind(Object(O.a)(Object(O.a)(n))),n}return Object(y.a)(t,e),Object(k.a)(t,[{key:"componentDidUpdate",value:function(){this.state.allowNew&&this.state.suggests.length&&document.getElementById("SuggestsListEnd").scrollIntoView()}},{key:"render",value:function(){var e=this,t=this.state.suggests.map(function(t){return t.isNew?i.a.createElement(d.b,{mutation:S,variables:{name:t.name},onCompleted:function(t){var n=t.addIngredient;return e.addToFilter(n)}},function(e){return i.a.createElement("li",{key:"s_".concat(t.id),onClick:e},"(+) ",t.name,"..")}):i.a.createElement("li",{key:"s_".concat(t.id),onClick:function(){return e.addToFilter(t)}},t.name)});return i.a.createElement("div",{className:"Search"},i.a.createElement("input",{ref:function(t){return e._input=t},autoFocus:this.state.autoFocus,value:this.state.value,onChange:this.handleChange,onKeyPress:this.handleValidate,placeholder:"Search ingredients.."}),i.a.createElement("ul",{className:"Suggests"},t),i.a.createElement("div",{id:"SuggestsListEnd"}))}}]),t}(a.Component),q=n(40),D=n.n(q),T=(n(84),function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(E.a)(this,Object(w.a)(t).call(this,e))).remove=function(e){n.props.removeFilter(e)},n.update=function(e){n.setState(e,function(){n.props.updateFilter(n.state)})},n.filters=function(e){return e.filters.map(function(e){return i.a.createElement("li",{key:"f_".concat(e.id),onClick:function(){return n.remove(e)}},e.name)})},n.state={cookingtime:{min:0,max:120},worktime:{min:0,max:120}},n}return Object(y.a)(t,e),Object(k.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"Filter"},i.a.createElement("p",{className:"label"},"Prep time (mn)"),i.a.createElement(D.a,{maxValue:120,minValue:0,formatLabel:function(e){return"".concat(e)},value:this.state.worktime,onChange:function(t){return e.update({worktime:t})}}),i.a.createElement("p",{className:"label"},"Cooking time (mn)"),i.a.createElement(D.a,{maxValue:120,minValue:0,formatLabel:function(e){return"".concat(e)},value:this.state.cookingtime,onChange:function(t){return e.update({cookingtime:t})}}),i.a.createElement("ul",null,this.filters(this.props)),i.a.createElement("p",{className:"clear"},"\xd7 Clear filter"))}}]),t}(a.Component)),B=function(e){function t(){var e,n;Object(v.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(w.a)(t)).call.apply(e,[this].concat(r)))).listItems=function(e){return e.items.map(function(t){return i.a.createElement(s.b,{key:"r_".concat(t.id),to:"/recipe/".concat(t.id)},i.a.createElement("li",null,i.a.createElement("div",{className:"title"},t.title),i.a.createElement("div",{className:"book"},t.book),i.a.createElement("div",{className:"desc"},t.description),i.a.createElement("div",{className:"items"},e.filters.length," / ",t.ingredients.length," required")))})},n}return Object(y.a)(t,e),Object(k.a)(t,[{key:"render",value:function(){return i.a.createElement("ul",{className:"Results"},this.listItems(this.props))}}]),t}(a.Component),_=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(E.a)(this,Object(w.a)(t).call(this,e))).addFilter=function(e){n.setState(function(t){return{filters:[].concat(Object(b.a)(t.filters),[e])}},function(){return n.updateFilter()})},n.removeFilter=function(e){n.setState(function(t){return{filters:l.a.filter(t.filters,function(t){return t!==e})}},function(){return n.updateFilter()})},n.updateFilter=function(e){n.setState({cookbookFiltered:l.a.filter(n.state.cookbook,function(t){if(e){if(e.cookingtime&&(t.cookingtime>e.cookingtime.max||t.cookingtime<e.cookingtime.min))return!1;if(e.worktime&&(t.worktime>e.worktime.max||t.worktime<e.worktime.min))return!1}return 0===l.a.difference(l.a.map(n.state.filters,"id"),l.a.map(t.ingredients,"idIngredient")).length})})},n.state={cookbook:n.props.cookbook,cookbookFiltered:l.a.slice(n.props.cookbook,0,20),filters:[]},n}return Object(y.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){window.scrollTo(0,0)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement(d.c,{query:F},function(t){var n=t.data;return i.a.createElement(R,{filterByIngredient:e.addFilter,ingredients:n.ingredients,autoFocus:!1})}),i.a.createElement(T,{updateFilter:this.updateFilter,removeFilter:this.removeFilter,filters:this.state.filters}),i.a.createElement("hr",null),i.a.createElement(B,{items:this.state.cookbookFiltered,filters:this.state.filters}),i.a.createElement(s.b,{to:"/add"},i.a.createElement("div",{className:"Button"},"+")))}}]),t}(a.Component),P=n(54),A=n(34),L=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(E.a)(this,Object(w.a)(t).call(this,e))).dismiss=function(e){e.stopPropagation(),n.setState({hasError:!1})},n.state={hasError:!0,error:e.error},n}return Object(y.a)(t,e),Object(k.a)(t,[{key:"render",value:function(){return this.state.hasError?i.a.createElement("div",{className:"Error"},i.a.createElement("h1",null,"!"),i.a.createElement("p",null,this.state.error),i.a.createElement("button",{onClick:this.dismiss},"OK")):null}}]),t}(a.Component);function Q(){var e=Object(j.a)(["\n\tmutation deleteRecipe($id: ID!) {\n\t\tdeleteRecipe(id: $id) @client\n\t}\n"]);return Q=function(){return e},e}function W(){var e=Object(j.a)(["\n\tmutation addRecipe($title: String!, $book: String!, $page: Int!, $people: Int!, $cookingtime: Int!, $worktime: Int!, $description: String!, $ingredients: [RecipeIngredient]) {\n\t\taddRecipe(title: $title, book: $book, page: $page, people: $people, cookingtime: $cookingtime, worktime: $worktime, description: $description, ingredients: $ingredients) @client\n\t}\n"]);return W=function(){return e},e}function V(){var e=Object(j.a)(["\n\tquery {\n\t\tgetRecipe(id: $id) @client {\n\t\t\tid,\n\t\t\ttitle,\n\t\t\tbook,\n\t\t\tpage,\n\t\t\tpeople,\n\t\t\tcookingtime,\n\t\t\tworktime,\n\t\t\tdescription,\n\t\t\tingredients {\n\t\t\t\tidIngredient,\n\t\t\t\tname,\n\t\t\t\tqtx,\n\t\t\t}\n\t\t}\n\t}\n"]);return V=function(){return e},e}function H(){var e=Object(j.a)(["\n  query {\n\tcookbook @client {\n\t\tid,\n\t\ttitle,\n\t\tbook,\n\t\tpage,\n\t\tpeople,\n\t\tcookingtime,\n\t\tworktime,\n\t\tdescription,\n\t\tingredients {\n\t\t\tidIngredient,\n\t\t\tname,\n\t\t\tqtx,\n\t\t}\n\t}\n  }\n"]);return H=function(){return e},e}var M=I()(H()),U=I()(V()),J=I()(W()),K=I()(Q()),z={Query:{getRecipe:function(e,t,n){var a=t.id;return n.cache.readQuery({query:M}).cookbook.filter(function(e){return e.id==a})[0]}},Mutation:{addRecipe:function(e,t,n){var a=t.title,i=t.book,r=t.page,o=t.people,c=t.cookingtime,s=t.worktime,u=t.description,d=t.ingredients,m=n.cache;if(l.a.isEmpty(a))throw"Title field is required.";if(l.a.isEmpty(d))throw"Recipe must have at least one ingredient.";if(!l.a.isEmpty(o)&&!l.a.isNumber(o))throw"People must be a numeric value.";if(!l.a.isEmpty(r)&&!l.a.isNumber(r))throw"Page must be a numeric value.";if(!l.a.isEmpty(c)&&!l.a.isNumber(c))throw"Cooking duration must be a numeric value in minutes.";if(!l.a.isEmpty(s)&&!l.a.isNumber(s))throw"Cooking preparation must be a numeric value in minutes.";var p=m.readQuery({query:M}),g={__typename:"Recipe",id:p.cookbook.length?l.a.maxBy(p.cookbook,"id").id+1:1,title:a,book:i,page:r,people:o,cookingtime:c,worktime:s,description:u,ingredients:d},h={cookbook:[].concat(Object(b.a)(p.cookbook),[g])};return m.writeData({data:h}),g},deleteRecipe:function(e,t,n){var a=t.id,i=n.cache,r={cookbook:i.readQuery({query:M}).cookbook.filter(function(e){return e.id!=a})};return i.writeData({data:r}),!0}}},G=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(E.a)(this,Object(w.a)(t).call(this,e))).handleInputChange=function(e){var t=e.target,a=t.value,i=t.name;n.setState(Object(A.a)({},i,a))},n.handleInputQuantityChange=function(e){var t=e.target.attributes["data-pos"].value,a=e.target.value;n.setState(function(e){return e.ingredients[t].qtx=a,e})},n.handleInputDeletion=function(e){n.setState(function(t){return t.ingredients.splice(e,1),t})},n.addIngredient=function(e){n.setState(function(t){return{ingredients:[].concat(Object(b.a)(t.ingredients),[{__typename:"RecipeIngredient",idIngredient:e.id,name:e.name,qtx:""}])}})},n.redirectToHome=function(){n.props.history.push("/")},n.props.recipe?n.state=Object(P.a)({},n.props.recipe):n.state={id:null,title:"",book:"",page:"",people:"",cookingtime:"",worktime:"",description:"",ingredients:[]},n}return Object(y.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){window.scrollTo(0,0)}},{key:"render",value:function(){var e=this,t={};this.state.id&&(t={readOnly:"readOnly"});var n=0,a=this.state.ingredients.map(function(a){var r=n;return n++,i.a.createElement("div",{className:"row",key:r},i.a.createElement("input",{disabled:!0,type:"text",value:a.name}),i.a.createElement("input",Object.assign({},t,{autoFocus:!0,"data-pos":r,type:"text",placeholder:"Quantity",onChange:e.handleInputQuantityChange,value:a.qtx})),e.state.id?null:i.a.createElement("label",{onClick:function(){return e.handleInputDeletion(r)}},"\xd7"),i.a.createElement("br",null))});return i.a.createElement("div",{className:"App Recipe"},i.a.createElement(s.b,{to:"/"},i.a.createElement("div",{className:"close"},"\xd7")),i.a.createElement("form",null,i.a.createElement("label",null,"* Title",i.a.createElement("input",Object.assign({},t,{name:"title",type:"text",value:this.state.title,placeholder:"Recipe title",onChange:this.handleInputChange}))),i.a.createElement("label",null,"Book",i.a.createElement("div",{className:"flex"},i.a.createElement("input",Object.assign({},t,{name:"book",type:"text",value:this.state.book,placeholder:"Book reference",onChange:this.handleInputChange})),i.a.createElement("input",Object.assign({},t,{name:"page",type:"number",value:this.state.page,placeholder:"Page",style:{width:"40px"},onChange:this.handleInputChange})))),i.a.createElement("label",null,"Peoples",i.a.createElement("input",Object.assign({},t,{name:"people",type:"number",value:this.state.people,placeholder:"How many people?",onChange:this.handleInputChange}))),i.a.createElement("label",null,"Duration",i.a.createElement("div",{className:"flex"},i.a.createElement("input",Object.assign({},t,{name:"worktime",type:"number",value:this.state.worktime,placeholder:"Prep (mn)",onChange:this.handleInputChange})),i.a.createElement("input",Object.assign({},t,{name:"cookingtime",type:"number",value:this.state.cookingtime,placeholder:"Cooking (mn)",onChange:this.handleInputChange})))),i.a.createElement("label",null,"Description",i.a.createElement("input",Object.assign({},t,{name:"description",type:"text",value:this.state.description,placeholder:"(Optional)",onChange:this.handleInputChange}))),this.state.id?i.a.createElement("div",null,i.a.createElement("hr",null),a):i.a.createElement("div",null,i.a.createElement("label",null,"* Ingredients list"),i.a.createElement(d.c,{query:F},function(t){var n=t.data;return i.a.createElement("div",null,i.a.createElement(R,{filterByIngredient:e.addIngredient,ingredients:n.ingredients,allowNew:!0}),a)}))),this.state.id?i.a.createElement(d.b,{mutation:K,variables:{id:this.state.id},onCompleted:function(){return e.redirectToHome()}},function(e){return i.a.createElement("div",{className:"Button delete",onClick:e},"DELETE")}):i.a.createElement(d.b,{mutation:J,variables:this.state,onCompleted:function(){return e.redirectToHome()}},function(e,t){var n=t.error;return i.a.createElement("div",{className:"Button add",onClick:e},"ADD",n?i.a.createElement(L,{error:n}):null)}))}}]),t}(a.Component),X=new p.a;Object(g.persistCache)({cache:X,storage:window.localStorage}).then(function(){window.localStorage.getItem("apollo-cache-persist")||(console.warn("Cache is empty, applying initial state."),X.writeData({data:{ingredients:[],cookbook:[]}}));var e=new m.a({cache:X,resolvers:Object(c.merge)($,z)});o.a.render(i.a.createElement(d.a,{client:e},i.a.createElement(d.c,{query:M},function(e){var t=e.loading,n=e.error,a=e.data;return t?i.a.createElement("span",null,"loading..."):n?i.a.createElement("span",null,"Oops.."):i.a.createElement(s.a,{basename:"/purbeurre"},i.a.createElement("div",null,i.a.createElement(u.a,{exact:!0,path:"/",render:function(e){return i.a.createElement(_,Object.assign({},e,{cookbook:a.cookbook}))}}),i.a.createElement(u.a,{exact:!0,path:"/add",component:G}),i.a.createElement(u.a,{exact:!0,path:"/recipe/:id",render:function(e){return i.a.createElement(d.c,{query:U,variables:{id:e.match.params.id}},function(t){var n=t.loading,a=t.error,r=t.data;return n?i.a.createElement("span",null,"loading..."):a?i.a.createElement("span",null,"Oops.."):i.a.createElement(G,{recipe:r.getRecipe,history:e.history})})}})))})),document.getElementById("root"))}),function(e){if("serviceWorker"in navigator){if(new URL("/purbeurre",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/purbeurre","/service-worker.js");h?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):f(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):f(t,e)})}}()}},[[57,1,2]]]);
//# sourceMappingURL=main.7dead68b.chunk.js.map